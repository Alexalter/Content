<script type="text/javascript">
    //<![CDATA[
    {{modurl modname='Content' type=user func=view preview=1 pid=__PID__ assign=previewUrl}}
    content.previewUrl = "{{$previewUrl}}";

    function contentToggle(id)
    {
        $('contentTogglePageId').value = id;
        contentPost();
    }
    //]]>
</script>

{formpostbackfunction function='contentPost' commandName='toggleExpand'}
<input type="hidden" id="contentTogglePageId" name="contentTogglePageId" />
{modurl modname='Content' type=edit func=translatepage pid=$smarty.ldelim|cat:"commandArgument"|cat:$smarty.rdelim assign=translateUrl}
{usergetvar name=uname uid=$page.lu_uid assign=updaterName}

{formcontextmenu id="contentTocMenu" width="auto"}
{formcontextmenuitem __title='Edit' imageURL="images/icons/extrasmall/edit.gif" commandName="edit"}
{formcontextmenuitem __title='Preview' imageURL="images/icons/extrasmall/14_layer_visible.gif" commandScript="content.popupPreviewWindow(commandArgument)"}
{formcontextmenuseparator}
{if $access.pageCreateAllowed}
{formcontextmenuitem __title='New page' imageURL="images/icons/extrasmall/insert_table_row.gif" commandName="newPage"}
{formcontextmenuitem __title='New sub-page' imageURL="images/icons/extrasmall/insertcell.gif" commandName="newSubPage"}
{/if}
{formcontextmenuitem __title='Decrease indent' imageURL="images/icons/extrasmall/format_decreaseindent.gif" commandName="decIndent"}
{formcontextmenuitem __title='Increase indent' imageURL="images/icons/extrasmall/format_increaseindent.gif" commandName="incIndent"}
{if $multilingual}{formcontextmenuitem __title='Translate' imageURL="images/icons/extrasmall/voice-support.gif" commandRedirect=$translateUrl}{/if}
{if $access.pageDeleteAllowed}{formcontextmenuitem __title='Delete' imageURL="images/icons/extrasmall/delete_table_row.gif" commandName='deletePage' __confirmMessage='Delete'}{/if}
{if $enableVersioning}{formcontextmenuitem __title='History' imageURL="images/icons/extrasmall/clock.gif" commandName='history'}{/if}
{/formcontextmenu}

<div class="content-toc">
    <table class="z-datatable">
        <thead>
            <tr>
                <th>{gt text="Page title [id]"}</th>
                <th>{if $enableVersioning}{gt text="Last updated (revision)"}{else}{gt text="Last updated"}{/if}</th>
                <th>{gt text="Created"}</th>
                {if $multilingual}<th>{gt text="Language"}</th>{/if}
            </tr>
        </thead>
        <tbody>
            {foreach from=$pages item=page}
            <tr class="{cycle values="z-odd,z-even"}">
                <td style="padding-left: {$page.level}em">
                    <div id="page_{$page.id}">
                        {if $page.setRight - $page.setLeft != 1}
                        {if $page.isExpanded}<img src="modules/content/pnimages/page-expanded.gif" onclick="contentToggle({$page.id})" alt="" class="clickable" />{else}<img src="modules/content/pnimages/page-collapsed.gif" onclick="contentToggle({$page.id})" alt="" class="clickable" />{/if}
                        {else}
                        <img src="modules/content/pnimages/page-none.gif" alt="" />
                        {/if}    

                        {if $access.pageEditAllowed}
                        {if $page.isInMenu}
                        <img src="modules/content/pnimages/menupageactive.gif" alt="{gt text="Page online and in menu"}" title="{gt text="Page online and in menu"}" class="dragable"/>
                        {else}
                        <img src="modules/content/pnimages/menupageinactive.gif" alt="{gt text="Page offline or not in menu"}" title="{gt text="Page offline or not in menu"}" class="dragable"/>
                        {/if}
                        {/if}

                        <a href="{modurl modname=Content type=edit func=editpage pid=$page.id}" id="anchor_{$page.id}">
                            {$page.title} [{$page.id}{* {$page.position}|{$page.setLeft}/{$page.setRight}  *}]
                        </a>{if $access.pageEditAllowed}&nbsp;{formcontextmenureference menuId="contentTocMenu" commandArgument=$page.id imageURL="images/icons/extrasmall/next.gif"}{/if}
                    </div>
                </td>
                <td>{gt text="on $1%s by $2%s" tag1=$page.lu_date|dateformat:'datebrief' tag2=$updaterName|userprofilelink}
                    {if $enableVersioning}
                      {modapifunc modname=Content type=history func=getPageVersionNo pageId=$page.id assign=versionNo}
                      (#{$versionNo})
                    {/if}
                </td>
                <td>{gt text="on $1%s by $2%s" tag1=$page.cr_date|dateformat:'datebrief' tag2=$page.uname|userprofilelink}</td>
                {if $multilingual}<td>{if $page.isTranslated}{gt text="$1%s ($2%s original)" tag1=$language|getlanguagename tag2=$page.language|getlanguagename}{elseif $language neq $page.language}{gt text="%s original used" tag1=$page.language|getlanguagename}{else}{gt text="%s" tag1=$page.language|getlanguagename}{/if}</td>{/if}
            </tr>
            {foreachelse}
            <tr class="z-datatableempty"><td colspan="{if $multilingual}4{else}3{/if}">{gt text="No pages available."}</td></tr>
            {/foreach}
        </tbody>
    </table>
</div>
